(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{461:function(n,a,s){n.exports=s.p+"assets/img/0522_1.a3954ae2.png"},462:function(n,a,s){n.exports=s.p+"assets/img/0522_2.8b107bde.png"},471:function(n,a,s){"use strict";s.r(a);var e=s(2),t=Object(e.a)({},(function(){var n=this,a=n.$createElement,e=n._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[e("h2",{attrs:{id:"前言"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[n._v("#")]),n._v(" 前言")]),n._v(" "),e("p",[n._v("因为"),e("a",{attrs:{href:"https://github.com/lzyzsd/JsBridge",target:"_blank",rel:"noopener noreferrer"}},[n._v("JsBridge"),e("OutboundLink")],1),n._v("里的"),e("code",[n._v("example")]),n._v("内容很多，自己第一次看这个东西，一下子还是一头雾水的，关于"),e("code",[n._v("Android")]),n._v("与"),e("code",[n._v("JavaScript")]),n._v("的交互，之前都是直接使用"),e("code",[n._v("WebView")]),n._v("来实现的，可是后来并没有深入去研究这个东西，原先项目使用到的"),e("code",[n._v("WebView")]),n._v("，也因为紧紧只是展示"),e("code",[n._v("html")]),n._v("页面，为了优化，也换成了"),e("a",{attrs:{href:"https://x5.tencent.com",target:"_blank",rel:"noopener noreferrer"}},[n._v("TBS 腾讯浏览服务"),e("OutboundLink")],1),n._v("，之后再也没接触到 Android 与 JS 交互相关的知识，就趁这个机会，把这方面的一点一点心得记录一下。")]),n._v(" "),e("h2",{attrs:{id:"准备工作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[n._v("#")]),n._v(" 准备工作")]),n._v(" "),e("p",[n._v("1.首先，需要在根目录下的"),e("code",[n._v("build.gradle")]),n._v("文件中加上：")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('repositories {\n    // ...\n    maven { url "https://jitpack.io" }\n}\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br")])]),e("p",[n._v("2.然后，需要在"),e("code",[n._v("app")]),n._v("目录下的"),e("code",[n._v("build.gradle")]),n._v("文件中加上依赖：")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v("implementation 'com.github.lzyzsd:jsbridge:1.0.4'\n")])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br")])]),e("h2",{attrs:{id:"开始使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#开始使用"}},[n._v("#")]),n._v(" 开始使用")]),n._v(" "),e("p",[e("strong",[n._v("一、实现通过 JavaScript 调用 Android 方法")])]),n._v(" "),e("p",[n._v("1.在"),e("code",[n._v("src/main")]),n._v("文件夹下新建一个"),e("code",[n._v("assets")]),n._v("文件夹，然后在里面新建一个"),e("code",[n._v("demo.html")]),n._v("文件，内容如下所示：")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('<html>\n<head>\n    <meta content="text/html; charset=utf-8" http-equiv="content-type" />\n</head>\n\n<body style="background-color:antiquewhite;">\nHTML\n<p>\n    <input type="button" value="Call Android Method" onclick="testClicked()" />\n</p>\n<p style="width: 100%;">\n    <span id="show">Show Contents:</span>\n</p>\n</body>\n<script>\n    function testClicked() {\n      window.WebViewJavascriptBridge.callHandler(\n        "jsCallAndroid",\n        { name: "weihao" },\n        function(responseData) {\n          document.getElementById("show").innerHTML = responseData;\n        }\n      );\n    }\n    /**\n      这个库将把WebViewJavascriptBridge对象注入到窗口对象。\n      所以在您的js中，在使用WebViewJavascriptBridge之前，\n      必须检测WebViewJavascriptBridge是否存在。\n      如果WebViewJavascriptBridge未退出，\n      则可以侦听WebViewJavascriptBridgeReady事件\n    */\n    connectWebViewJavascriptBridge(function(bridge) {\n      bridge.init(function(message, responseCallback) {\n        if (responseCallback) {\n          responseCallback(data);\n        }\n      });\n    });\n    function connectWebViewJavascriptBridge(callback) {\n      if (window.WebViewJavascriptBridge) {\n        callback(WebViewJavascriptBridge);\n      } else {\n        document.addEventListener(\n          "WebViewJavascriptBridgeReady",\n          function() {\n            callback(WebViewJavascriptBridge);\n          },\n          false\n        );\n      }\n    }\n  <\/script>\n</html>\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br"),e("span",{staticClass:"line-number"},[n._v("17")]),e("br"),e("span",{staticClass:"line-number"},[n._v("18")]),e("br"),e("span",{staticClass:"line-number"},[n._v("19")]),e("br"),e("span",{staticClass:"line-number"},[n._v("20")]),e("br"),e("span",{staticClass:"line-number"},[n._v("21")]),e("br"),e("span",{staticClass:"line-number"},[n._v("22")]),e("br"),e("span",{staticClass:"line-number"},[n._v("23")]),e("br"),e("span",{staticClass:"line-number"},[n._v("24")]),e("br"),e("span",{staticClass:"line-number"},[n._v("25")]),e("br"),e("span",{staticClass:"line-number"},[n._v("26")]),e("br"),e("span",{staticClass:"line-number"},[n._v("27")]),e("br"),e("span",{staticClass:"line-number"},[n._v("28")]),e("br"),e("span",{staticClass:"line-number"},[n._v("29")]),e("br"),e("span",{staticClass:"line-number"},[n._v("30")]),e("br"),e("span",{staticClass:"line-number"},[n._v("31")]),e("br"),e("span",{staticClass:"line-number"},[n._v("32")]),e("br"),e("span",{staticClass:"line-number"},[n._v("33")]),e("br"),e("span",{staticClass:"line-number"},[n._v("34")]),e("br"),e("span",{staticClass:"line-number"},[n._v("35")]),e("br"),e("span",{staticClass:"line-number"},[n._v("36")]),e("br"),e("span",{staticClass:"line-number"},[n._v("37")]),e("br"),e("span",{staticClass:"line-number"},[n._v("38")]),e("br"),e("span",{staticClass:"line-number"},[n._v("39")]),e("br"),e("span",{staticClass:"line-number"},[n._v("40")]),e("br"),e("span",{staticClass:"line-number"},[n._v("41")]),e("br"),e("span",{staticClass:"line-number"},[n._v("42")]),e("br"),e("span",{staticClass:"line-number"},[n._v("43")]),e("br"),e("span",{staticClass:"line-number"},[n._v("44")]),e("br"),e("span",{staticClass:"line-number"},[n._v("45")]),e("br"),e("span",{staticClass:"line-number"},[n._v("46")]),e("br"),e("span",{staticClass:"line-number"},[n._v("47")]),e("br"),e("span",{staticClass:"line-number"},[n._v("48")]),e("br"),e("span",{staticClass:"line-number"},[n._v("49")]),e("br"),e("span",{staticClass:"line-number"},[n._v("50")]),e("br"),e("span",{staticClass:"line-number"},[n._v("51")]),e("br"),e("span",{staticClass:"line-number"},[n._v("52")]),e("br"),e("span",{staticClass:"line-number"},[n._v("53")]),e("br")])]),e("p",[n._v("2.需要在"),e("code",[n._v("activity_main.xml")]),n._v("文件中，加上布局：")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('    <com.github.lzyzsd.jsbridge.BridgeWebView\n        android:id="@+id/bridgeWebview"\n        app:layout_constraintTop_toTopOf="parent"\n        android:layout_width="match_parent"\n        android:layout_height="wrap_content"/>\n    <TextView\n        android:id="@+id/tv_content"\n        app:layout_constraintTop_toBottomOf="@+id/bt_calljs"\n        app:layout_constraintLeft_toLeftOf="@+id/bt_calljs"\n        android:layout_width="wrap_content"\n        android:layout_marginTop="10dp"\n        android:text="Content"\n        android:layout_height="wrap_content"/>\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br")])]),e("p",[n._v("3.在"),e("code",[n._v("MainActivity.java")]),n._v("中注册一个方法"),e("code",[n._v("jsCallAndroid")]),n._v("，用于"),e("code",[n._v("JS")]),n._v("调用，并且使用"),e("code",[n._v("loadUrl")]),n._v("加载"),e("code",[n._v("demo.html")]),n._v("文件，代码如下所示：")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('        bridgeWebview.registerHandler("jsCallAndroid", new BridgeHandler() {\n            @Override\n            public void handler(String data, CallBackFunction function) {\n                tvContent.setText("params from JavaScript: " + data);\n                JSONObject jsonObject = new JSONObject();\n                try {\n                    jsonObject.put("nickname", "braveheart");\n                    jsonObject.put("age", "18");\n                    jsonObject.put("address", "China");\n                } catch (JSONException e) {\n                    e.printStackTrace();\n                }\n                function.onCallBack("return data from Android: "+jsonObject.toString());\n            }\n        });\n        bridgeWebview.loadUrl("file:///android_asset/demo.html");\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br"),e("span",{staticClass:"line-number"},[n._v("12")]),e("br"),e("span",{staticClass:"line-number"},[n._v("13")]),e("br"),e("span",{staticClass:"line-number"},[n._v("14")]),e("br"),e("span",{staticClass:"line-number"},[n._v("15")]),e("br"),e("span",{staticClass:"line-number"},[n._v("16")]),e("br")])]),e("p",[n._v("上面主要是为了使"),e("code",[n._v("Android")]),n._v("与"),e("code",[n._v("JS")]),n._v("的交互更为形象，所以就模拟成一个网络请求获取用户信息的方式来说明，其意思是，当从"),e("code",[n._v("JS")]),n._v("调用这个"),e("code",[n._v("Android")]),n._v("方法"),e("code",[n._v("jsCallAndroid")]),n._v("时，需要传入参数"),e("code",[n._v("data")]),n._v("，也就是"),e("code",[n._v('{ "name" : "weihao" }')]),n._v("，然后会从"),e("code",[n._v("Android")]),n._v("返回用户信息，也就是：")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('{"nickname":"braveheart","age":"18","address":"China"}\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br")])]),e("p",[n._v("4.运行效果，如下图所示：")]),n._v(" "),e("p",[e("img",{attrs:{src:s(461),alt:""}})]),n._v(" "),e("p",[n._v("上部分是"),e("code",[n._v("demo.html")]),n._v("文件页面，下部分是"),e("code",[n._v("Android")]),n._v("原生页面，其中可以看到，当点击"),e("code",[n._v("Call Android Method")]),n._v("按钮时，"),e("code",[n._v("JS")]),n._v("调用"),e("code",[n._v("Android")]),n._v("方法"),e("code",[n._v("jsCallAndroid")]),n._v("，"),e("code",[n._v("Android")]),n._v("页面的"),e("code",[n._v("TextView")]),n._v("控件获取到了传过来的参数"),e("code",[n._v('{ "name" : "weihao" }')]),n._v("，并且在"),e("code",[n._v("demo.html")]),n._v("页面确实从"),e("code",[n._v("Android")]),n._v("返回了用户信息：")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('{"nickname":"braveheart","age":"18","address":"China"}\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br")])]),e("p",[e("strong",[n._v("二、实现在 Android 里调用 JavaScript 方法")])]),n._v(" "),e("p",[n._v("1.在"),e("code",[n._v("activity_main.xml")]),n._v("文件中，加上一个"),e("code",[n._v("Button")]),n._v("控件，代码如下所示：")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('    <Button\n        android:id="@+id/bt_call_js"\n        app:layout_constraintTop_toBottomOf="@+id/tv_android"\n        app:layout_constraintLeft_toLeftOf="@+id/tv_android"\n        android:layout_width="wrap_content"\n        android:textAllCaps="false"\n        android:text="Call JavaScript Method"\n        android:layout_height="wrap_content"/>\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br")])]),e("p",[n._v("2.需要在"),e("code",[n._v("demo.html")]),n._v("文件里的"),e("code",[n._v("connectWebViewJavascriptBridge")]),n._v("方法里加上一个让"),e("code",[n._v("Android")]),n._v("调用的方法"),e("code",[n._v("androidCallJS")]),n._v("，代码如下所示：")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('      bridge.registerHandler("androidCallJS", function(data, responseCallback) {\n        document.getElementById("show").innerHTML =\n          "params from Android：" + data;\n        if (responseCallback) {\n          var responseData = `{"nickname":"braveheart","age":"18","address":"China"}`;\n          responseCallback(responseData);\n        }\n      });\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br")])]),e("p",[n._v("3.在"),e("code",[n._v("MainActivity.java")]),n._v("中加上如下代码，用于调用"),e("code",[n._v("JS")]),n._v("里的"),e("code",[n._v("androidCallJS")]),n._v("方法，代码如下所示：")]),n._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[n._v('        btCallJS.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                bridgeWebview.callHandler("androidCallJS","{ name: \\"weihao\\" }", new CallBackFunction() {\n                    @Override\n                    public void onCallBack(String data) {\n                        tvContent.setText("return data from JavaScript: "+data);\n                    }\n                });\n            }\n        });\n')])]),n._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[n._v("1")]),e("br"),e("span",{staticClass:"line-number"},[n._v("2")]),e("br"),e("span",{staticClass:"line-number"},[n._v("3")]),e("br"),e("span",{staticClass:"line-number"},[n._v("4")]),e("br"),e("span",{staticClass:"line-number"},[n._v("5")]),e("br"),e("span",{staticClass:"line-number"},[n._v("6")]),e("br"),e("span",{staticClass:"line-number"},[n._v("7")]),e("br"),e("span",{staticClass:"line-number"},[n._v("8")]),e("br"),e("span",{staticClass:"line-number"},[n._v("9")]),e("br"),e("span",{staticClass:"line-number"},[n._v("10")]),e("br"),e("span",{staticClass:"line-number"},[n._v("11")]),e("br")])]),e("p",[n._v("以上也是通过模拟网络请求获取用户信息的方式，来形象说明"),e("code",[n._v("Android")]),n._v("与"),e("code",[n._v("JS")]),n._v("的交互，只不过改成了从"),e("code",[n._v("Android")]),n._v("传入用户名，从"),e("code",[n._v("JS")]),n._v("返回用户信息而已。")]),n._v(" "),e("p",[n._v("4.运行效果，如下图所示：")]),n._v(" "),e("p",[e("img",{attrs:{src:s(462),alt:""}})])])}),[],!1,null,null,null);a.default=t.exports}}]);